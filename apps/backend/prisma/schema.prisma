// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Post {
  id           String      @id @default(cuid())
  title        String?
  body         String
  type         PostType
  status       PostStatus  @default(DRAFT)
  scheduledFor DateTime?
  publishedAt  DateTime?
  images       PostImage[]
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  @@map("posts")
}

model PostImage {
  id        String  @id @default(cuid())
  post      Post    @relation(fields: [postId], references: [id], onDelete: Cascade)
  postId    String
  image     Image   @relation(fields: [imageId], references: [id])
  imageId   String
  position  Int     // 排序
  cropData  Json?   // 儲存前端裁切資訊 { x, y, width, height }

  @@map("post_images")
}

model Image {
  id          String      @id @default(cuid())
  url         String      // SVG 原始路徑
  previewUrl  String?     // (Optional) 預先轉好的 PNG 預覽圖
  mimeType    String      @default("image/svg+xml")
  tags        String[]
  createdAt   DateTime    @default(now())
  lastUsedAt  DateTime?
  usedCount   Int         @default(0)
  isDeleted   Boolean     @default(false)
  postImages  PostImage[]

  @@map("images")
}

model HotTopic {
  id        String   @id @default(cuid())
  title     String
  source    String
  date      DateTime
  createdAt DateTime @default(now())

  @@map("hot_topics")
}

model StyleSample {
  id        String   @id @default(cuid())
  body      String
  type      PostType
  createdAt DateTime @default(now())

  @@map("style_samples")
}

enum PostType {
  CAT
  LIFE
}

enum PostStatus {
  DRAFT
  PUBLISHED
}

